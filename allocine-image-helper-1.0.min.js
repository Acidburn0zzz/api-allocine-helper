/**
* Allocin√© Image Helper
* @author Etienne Gauvin
* @date 26/01/2012
* @licence Creative Commons BY-NC
* @version 1.00
*/

const AIH_DEFAULT_IMAGE_HOST="images.allocine.fr";const AIH_DEFAULT_IMAGE_PATH="commons/emptymedia/AffichetteAllocine.gif";var AlloImage=function(url){this.icons={'play.png':null,'overplay.png':null,'overlayVod120.png':{1:'r',2:120,3:160}};this.isDefaultImage=true;this.imageIcon=false;this.imageBorder=false;this.imageSize=false;this.imageHost=false;this.imagePath=false;if(url===undefined){this.imageHost=AIH_DEFAULT_IMAGE_HOST;this.imagePath=AIH_DEFAULT_IMAGE_PATH;}else
{this.isDefaultImage=false;var key=['source','scheme','authority','userInfo','user','pass','host','port','relative','path','directory','file','query','fragment'];var parser=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/;var m=parser.exec(url),urlParse={},i=14;while(i--){if(m[i]){urlParse[key[i]]=m[i];}}this.imageHost=(urlParse['host']!==undefined)?urlParse['host']:AIH_DEFAULT_IMAGE_HOST;if(urlParse['path']!==undefined)this.imagePath=urlParse['path'];else{alert("Ceci n'est pas un lien vers une image.");return false;}}var explodePath=this.imagePath.split('/');if(explodePath[0]==='')explodePath[0]=undefined;this.imagePath='';for(iPathPart in explodePath){if(explodePath[iPathPart]!==undefined){var pathPart=explodePath[iPathPart];var matches=false;if(pathPart.indexOf('o',0)===0&&(matches=pathPart.match(/^o_(.+)_(.+)_(.+)/i))!=undefined){this.icon(matches[3],matches[2],matches[1]);}else if(pathPart.indexOf('b',0)===0&&(matches=pathPart.match(/^b[xy]?_([0-9]+)_([0-9a-f]{6}|.*)/i))!=undefined){if(matches[2].search(/^[0-9a-f]{6}$/i)===-1)matches[2]="000000";this.border(matches[1],matches[2]);}else if(pathPart.indexOf('r',0)===0&&(matches=pathPart.match(/^r[xy]?_([0-9]+|[a-z0-9]+)_([0-9]+|[a-z0-9]+)/i))!=undefined){this.resize(matches[1],matches[2]);}else if(pathPart.indexOf('c',0)===0&&(matches=pathPart.match(/^c[xy]?_([0-9]+|[a-z0-9]+)_([0-9]+|[a-z0-9]+)/i))!=undefined){this.cut(matches[1],matches[2]);}else
{this.imagePath+=((this.imagePath==='')?'':'/')+explodePath[iPathPart];}}}this.icon=function(position,margin,icon){position=(position===undefined)?'c':position;margin=(margin===undefined)?4:margin;icon=(icon===undefined)?'play.png':icon;if(this.icons[icon]!=undefined){var p=this.icons[icon];switch(p[0]){case'r':this.resize(p[1],p[2]);break;case'c':this.cut(p[1],p[2]);break;}}this.imageIcon={'position':position.substring(0,2),'margin':margin,'icon':icon};return this;};;this.getIcon=function(){return this.imageIcon;};this.destroyIcon=function(){this.imageIcon=false;return this;};this.border=function(size,color){size=(size===undefined)?1:size;color=(color===undefined)?"000000":color;this.imageBorder={'size':size,'color':color};return this;};this.getBorder=function(){return this.imageBorder;};this.destroyBorder=function(){this.imageBorder=false;return this;};this.reset=function(){this.destroyBorder().destroyIcon().maxSize();return this;};this.resize=function(xmax,ymax){xmax=(xmax===undefined)?'x':xmax;ymax=(ymax===undefined)?'y':ymax;this.imageSize={'method':'r','xmax':xmax,'ymax':ymax};return this;};this.cut=function(xmax,ymax){this.imageSize={'method':'c','xmax':xmax,'ymax':ymax};return this;};this.getSize=function(){return this.imageSize;};this.maxSize=function(){this.imageSize=false;return this;};this.getImageHost=function(){return this.imageHost;};this.setImageHost=function(server){switch(server){case'default':case'de':case'filmstarts.de':case'es':case'sensacine.com':case'fr':case'allocine.fr':case'en':case'screenrush.co.uk':this.imageHost=this.imagesUrl;break;default:this.imageHost=server;}return this;};this.url=function(){var params=new Array();if(this.imageSize!==false)params[0]=this.imageSize.method+'_'+this.imageSize.xmax+'_'+this.imageSize.ymax;if(this.imageBorder!==false)params[1]='b_'+this.imageBorder.size+'_'+this.imageBorder.color;if(this.imageIcon!==false)params[2]='o_'+this.imageIcon.icon+'_'+this.imageIcon.margin+'_'+this.imageIcon.position;return'http://'+this.imageHost+(params.length?'/'+params.join('/'):'')+'/'+this.imagePath;};};